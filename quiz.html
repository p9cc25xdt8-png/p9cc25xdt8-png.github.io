<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>会計英語をクイズで学ぶ「しーぴーえいご」</title>
  <meta name="description" content="実務で使う会計・監査用語の英語をクイズ形式で楽しく学べる無料サイト。勘定科目や英語表現をまとめて習得！">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f0f4f8;--card:#fff;--text:#0f1724;--muted:#4b5563;--brand:#1f3c88;--accent:#3b82f6;--focus:#0b5fff;--error:#dc2626;--success:#059669;--shadow:0 20px 50px rgba(31,60,136,0.12)}
    
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes shimmer{0%{background-position:-1000px 0}100%{background-position:1000px 0}}
    
    body{font-family:'Inter','Noto Sans JP',system-ui,-apple-system,'Segoe UI',sans-serif;margin:0;padding:0;background:linear-gradient(135deg,#e0e7ff 0%,#f0f4f8 50%,#fef3c7 100%);background-attachment:fixed;color:var(--text);}
    header{background:linear-gradient(135deg,#1e3a8a 0%,var(--brand) 50%,#1e40af 100%);color:#fff;padding:32px 20px;text-align:center;box-shadow:0 8px 32px rgba(31,60,136,0.25);position:relative;overflow:hidden}
    header::before{content:'';position:absolute;top:0;left:-100%;width:200%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent);animation:shimmer 3s infinite}
    header h1{font-family:'Noto Sans JP', 'Inter';font-weight:700;margin:0;font-size:24px;text-shadow:0 2px 8px rgba(0,0,0,0.2)}
    .card{background:var(--card);max-width:760px;margin:24px auto;padding:28px;border-radius:16px;box-shadow:var(--shadow);animation:fadeIn 0.5s ease;border:1px solid rgba(255,255,255,0.8)}

    /* Subject tabs */
    .subject-tabs{display:flex;gap:10px;max-width:760px;margin:20px auto;padding:0 18px}
    .subject-tabs button{background:rgba(255,255,255,0.8);border:2px solid rgba(31,60,136,0.12);padding:10px 18px;border-radius:12px;cursor:pointer;color:var(--brand);font-weight:600;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);backdrop-filter:blur(10px)}
    .subject-tabs button:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(31,60,136,0.15)}
    .subject-tabs button[aria-selected="true"]{background:linear-gradient(135deg,var(--accent),var(--brand));color:#fff;border:none;box-shadow:0 8px 24px rgba(31,60,136,0.3);transform:translateY(-2px)}
    .subject-tabs button:focus-visible{outline:3px solid var(--focus);outline-offset:3px}

    .options{display:flex;flex-direction:column;gap:14px;margin:20px 0;padding:0;list-style:none}
    .card label{display:flex;align-items:center;gap:14px;padding:16px 20px;border:2px solid #e5e7eb;border-radius:12px;background:linear-gradient(135deg,#fff,#f8fafc);cursor:pointer;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);font-size:15px;position:relative;overflow:hidden}
    .card label::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(59,130,246,0.1),transparent);transition:left 0.5s}
    .card label:hover{background:linear-gradient(135deg,#f0f9ff,#dbeafe);border-color:#93c5fd;transform:translateX(4px);box-shadow:0 8px 24px rgba(59,130,246,0.15)}
    .card label:hover::before{left:100%}
    .card label input[type="radio"]{width:22px;height:22px;cursor:pointer;accent-color:var(--brand)}
    .card button{margin-top:16px;padding:14px 24px;background:linear-gradient(135deg,var(--brand),#1e40af);color:#fff;border:none;border-radius:12px;cursor:pointer;font-weight:700;font-size:16px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 8px 24px rgba(31,60,136,0.25);position:relative;overflow:hidden}
    .card button::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.3);transform:translate(-50%,-50%);transition:width 0.6s,height 0.6s}
    .card button:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(31,60,136,0.35)}
    .card button:active{transform:translateY(0)}
    .card button:active::before{width:300px;height:300px}

    .progress-bar{height:10px;background:linear-gradient(90deg,#e0e7ff,#f8fafc);border-radius:999px;overflow:hidden;margin:16px 0;box-shadow:inset 0 2px 4px rgba(0,0,0,0.06)}
    .progress-fill{height:100%;background:linear-gradient(90deg,#3b82f6,#1e40af,#7c3aed);width:0%;transition:width .6s cubic-bezier(.2,.9,.3,1);box-shadow:0 0 12px rgba(59,130,246,0.5)}

    /* answer highlight */
    .card label.correct{background:linear-gradient(135deg,#d1fae5,#ecfdf5);border-color:#34d399;box-shadow:0 8px 24px rgba(16,185,129,0.25);animation:fadeIn 0.4s ease}
    .card label.incorrect{background:linear-gradient(135deg,#fee2e2,#fef2f2);border-color:#f87171;box-shadow:0 8px 24px rgba(239,68,68,0.25);animation:fadeIn 0.4s ease}

    /* subtle fade for results */
    #result{transition:opacity .18s ease,transform .18s ease;opacity:1}

    nav.site-nav{background:#fff;border-bottom:1px solid #ddd;padding:12px 20px;position:relative}
    .menu-toggle{display:block;background:var(--brand);color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-weight:600;font-size:16px}
    nav.site-nav > div:last-child{display:none;flex-direction:column;gap:8px;margin-top:12px}
    nav.site-nav.open > div:last-child{display:flex}
    nav.site-nav a{text-decoration:none;color:var(--brand);font-weight:500;padding:10px 12px;background:#f8f9fa;border-radius:6px;display:block;text-align:center}
    nav.site-nav a:hover{background:#e9ecef}
    @media(min-width:768px){
      .menu-toggle{display:none}
      nav.site-nav > div:last-child{display:flex!important;flex-direction:row;gap:0;margin-top:0}
      nav.site-nav a{display:inline;padding:8px 12px;background:transparent;margin-right:15px}
      nav.site-nav a:last-child{margin-right:0}
      nav.site-nav a:hover{background:transparent;text-decoration:underline}
    }

    /* Results table */
    .result-table{width:100%;border-collapse:collapse;margin-top:12px}
    .result-table th,.result-table td{padding:12px;border-bottom:1px solid #eef2ff;text-align:left}
    .result-table td.ok{color:var(--success);font-weight:600}
    .result-table td.ng{color:var(--error);font-weight:600}
    .result-table button{padding:6px 10px;border-radius:6px;border:none;background:var(--accent);color:#fff;cursor:pointer}
    .result-table button:hover{filter:brightness(.95)}

    /* Skip link (visually hidden until focused) */
    .skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{position:static;left:auto;width:auto;height:auto;padding:8px 12px;margin:8px;background:#fff;border:1px solid #eef2ff;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}

    /* Focus styles for keyboard users */
    :focus{outline:none}
    :focus-visible{outline:none}
    /* Strong visible focus for keyboard users */
    button:focus-visible, .skip-link:focus-visible, .card label:focus-visible, nav.site-nav a:focus-visible, .result-table button:focus-visible {
      outline:3px solid var(--focus);
      outline-offset:3px;
      border-radius:6px;
      box-shadow:0 8px 24px rgba(11,88,255,0.10);
    }
    /* Larger ring in high-contrast mode */
    @media (prefers-contrast: more) {
      button:focus-visible, .skip-link:focus-visible, .card label:focus-visible, nav.site-nav a:focus-visible, .result-table button:focus-visible {
        outline-width:4px;
      }
    }
    .card label:focus-visible{box-shadow:0 8px 24px rgba(11,88,255,0.10)}

    /* ensure label text is high contrast */
    .card label{color:var(--text)}
    .card label.correct{background:linear-gradient(180deg,#e6ffef,#f0fff5);border-color:#bbf7d0;box-shadow:0 6px 14px rgba(4,110,60,0.06)}
    .card label.incorrect{background:linear-gradient(180deg,#fff1f0,#fff6f6);border-color:#f87171;box-shadow:0 6px 14px rgba(220,38,38,0.06)}
    .result-table td.ng{color:var(--error);font-weight:600}
    .result-table td.ok{color:var(--success);font-weight:600}
    .progress-bar{border:1px solid rgba(0,0,0,0.04);padding:2px;border-radius:10px}

    /* subject cards */
    .subject-cards{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:560px){.subject-cards{grid-template-columns:repeat(2,1fr)}}
    .subject-card{background:linear-gradient(135deg,#fff,#f8fafc);border:2px solid #e0e7ff;padding:20px;border-radius:16px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);text-align:left;position:relative;overflow:hidden;box-shadow:0 4px 12px rgba(31,60,136,0.08)}
    .subject-card::before{content:'';position:absolute;top:-50%;right:-50%;width:100%;height:100%;background:radial-gradient(circle,rgba(59,130,246,0.1),transparent);opacity:0;transition:opacity 0.3s}
    .subject-card:hover{background:linear-gradient(135deg,#f0f9ff,#dbeafe);border-color:#93c5fd;transform:translateY(-4px);box-shadow:0 12px 32px rgba(31,60,136,0.2)}
    .subject-card:hover::before{opacity:1}
    .subject-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .subject-card-title{font-size:16px;font-weight:700;color:var(--brand)}
    .subject-card .count{font-size:14px;color:#1e40af;font-weight:700;background:linear-gradient(135deg,#dbeafe,#e0e7ff);padding:6px 12px;border-radius:8px;box-shadow:0 2px 8px rgba(31,60,136,0.12)}
    .subject-card-buttons{display:flex;gap:10px}
    .subject-card-buttons button{flex:1;padding:10px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:700;font-size:14px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden}
    .subject-card-buttons button::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;background:rgba(255,255,255,0.3);border-radius:50%;transform:translate(-50%,-50%);transition:width 0.5s,height 0.5s}
    .subject-card-buttons button:active::before{width:200px;height:200px}
    .subject-card-buttons button:first-child{background:linear-gradient(135deg,var(--brand),#1e40af);color:#fff;box-shadow:0 4px 12px rgba(31,60,136,0.25)}
    .subject-card-buttons button:first-child:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(31,60,136,0.35)}
    .subject-card-buttons button:last-child{background:linear-gradient(135deg,#e5e7eb,#cbd5e1);color:var(--text);box-shadow:0 2px 8px rgba(0,0,0,0.08)}
    .subject-card-buttons button:last-child:hover{background:linear-gradient(135deg,#cbd5e1,#9ca3af);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.12)}

    /* explanation area */
    .explanation{margin-top:8px;font-size:14px;color:var(--muted)}

    /* hidden class */
    .hidden{display:none!important}

    /* ensure nav is always on top */
    nav.site-nav{position:relative;z-index:1000}
  </style>
</head>
<body>
  <!-- Skip link for accessibility -->
  <a href="#quiz" class="skip-link">クイズへスキップ</a>

  <nav class="site-nav">
    <button class="menu-toggle" onclick="this.parentElement.classList.toggle('open')">☰ メニュー</button>
    <div>
      <a href="index.html">トップ</a>
      <a href="quiz.html" aria-current="page">英語クイズ</a>
      <a href="account-list.html">勘定科目リスト</a>
      <a href="audit-list.html">監査論用語リスト</a>
      <a href="about.html">サービスについて</a>
    </div>
  </nav>

  <header>
    <h1>英語クイズ</h1>
    <p id="header-subtitle">クイズ形式で英語学習</p>
  </header>

  <section>
    <!-- Quiz top / subject selection -->
    <div id="quiz-home" class="card">
      <h2>クイズを始める</h2>
      <p>学習したいカテゴリを選んでください。「10問」ボタンでランダムに10問、「全問」ボタンで全問題を出題します。</p>
      
      <div style="margin:20px 0">
        <h3 style="font-size:18px;color:var(--brand);margin-bottom:12px;border-bottom:2px solid #eef2ff;padding-bottom:8px">勘定科目クイズ</h3>
        <p style="background:#fffbeb;border-left:4px solid #f59e0b;padding:12px;margin-bottom:12px;font-size:14px;color:var(--text)">
          <strong>注意：</strong>本クイズは日本基準を前提として作成しています。
        </p>
        <div class="subject-cards" role="list">
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">資産</span>
              <span class="count" data-key="資産">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button data-category="勘定科目等" data-subcategory="資産" data-mode="random">10問</button>
              <button data-category="勘定科目等" data-subcategory="資産" data-mode="all">全問</button>
            </div>
          </div>
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">負債</span>
              <span class="count" data-key="負債">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button data-category="勘定科目等" data-subcategory="負債" data-mode="random">10問</button>
              <button data-category="勘定科目等" data-subcategory="負債" data-mode="all">全問</button>
            </div>
          </div>
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">純資産</span>
              <span class="count" data-key="純資産">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button data-category="勘定科目等" data-subcategory="純資産" data-mode="random">10問</button>
              <button data-category="勘定科目等" data-subcategory="純資産" data-mode="all">全問</button>
            </div>
          </div>
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">収益</span>
              <span class="count" data-key="収益">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button data-category="勘定科目等" data-subcategory="収益" data-mode="random">10問</button>
              <button data-category="勘定科目等" data-subcategory="収益" data-mode="all">全問</button>
            </div>
          </div>
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">費用</span>
              <span class="count" data-key="費用">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button data-category="勘定科目等" data-subcategory="費用" data-mode="random">10問</button>
              <button data-category="勘定科目等" data-subcategory="費用" data-mode="all">全問</button>
            </div>
          </div>
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">すべての問題</span>
              <span class="count" data-key="勘定科目等">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button data-category="勘定科目等" data-mode="random">10問</button>
              <button data-category="勘定科目等" data-mode="all">全問</button>
            </div>
          </div>
        </div>
      </div>
      
      <div style="margin:20px 0">
        <h3 style="font-size:18px;color:var(--brand);margin-bottom:12px;border-bottom:2px solid #eef2ff;padding-bottom:8px">監査論クイズ</h3>
        <p style="background:#fffbeb;border-left:4px solid #f59e0b;padding:12px;margin-bottom:12px;font-size:14px;color:var(--text)">
          <strong>注意：</strong>本クイズは日本の監査論を前提として作成しています。
        </p>
        <div class="subject-cards" role="list">
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">基本概念</span>
              <span class="count" data-key="基本概念">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button data-category="監査論" data-subcategory="基本概念" data-mode="random">10問</button>
              <button data-category="監査論" data-subcategory="基本概念" data-mode="all">全問</button>
            </div>
          </div>
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">監査実務</span>
              <span class="count" data-key="監査実務">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button data-category="監査実務" data-subcategory="監査実務" data-mode="random">10問</button>
              <button data-category="監査実務" data-subcategory="監査実務" data-mode="all">全問</button>
            </div>
          </div>
          <div class="subject-card" role="listitem">
            <div class="subject-card-header">
              <span class="subject-card-title">すべての問題</span>
              <span class="count" id="all-audit-count">0問</span>
            </div>
            <div class="subject-card-buttons">
              <button id="all-audit-random" data-mode="random">10問</button>
              <button id="all-audit-all" data-mode="all">全問</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="progress-bar hidden" aria-hidden="true">
      <div class="progress-fill" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" style="width:0%"></div>
    </div>

    <div id="quiz" class="hidden"></div>
  </section>

  <footer style="text-align:center;padding:20px;background:#eee">
    <p>© 2026 しーぴーえいご</p>
    <p style="margin-top:8px">
      <a href="privacy.html" style="color:var(--brand);text-decoration:none;margin-right:15px">プライバシーポリシー</a>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSd3WB8gTG7oJBGPse9XFBi6AvNBxu7nkkL3BVHSP438u3E2LQ/viewform" target="_blank" style="color:var(--brand);text-decoration:none">お問い合わせ</a>
    </p>
  </footer>

  <script src="questions.js"></script>
  <script>
    // Initialize quiz UI
    document.addEventListener('DOMContentLoaded', function() {
      const counts = {
        '資産': 0,
        '負債': 0,
        '純資産': 0,
        '収益': 0,
        '費用': 0,
        '勘定科目等': 0,
        '基本概念': 0,
        'リスク・手続': 0,
        '監査報告': 0,
        '監査論': 0,
        '監査実務': 0
      };
      
      if (typeof questions !== 'undefined') {
        questions.forEach(q => {
          // サブカテゴリのカウント（勘定科目等と監査論のサブカテゴリ用）
          if (q.subcategory && counts.hasOwnProperty(q.subcategory)) {
            counts[q.subcategory]++;
          }
          // カテゴリのカウント（監査実務は独立カテゴリなのでカウントしない、勘定科目等と監査論のみ）
          if (q.category && counts.hasOwnProperty(q.category) && q.category !== '監査実務') {
            counts[q.category]++;
          }
        });
      }
      
      // Update counts in UI
      document.querySelectorAll('.count').forEach(el => {
        const key = el.getAttribute('data-key');
        if (key && counts.hasOwnProperty(key)) {
          el.textContent = counts[key] + '問';
        }
      });
      
      // すべての監査問題（監査論+監査実務）のカウント更新
      const allAuditCount = counts['監査論'] + counts['監査実務'];
      const allAuditCountEl = document.getElementById('all-audit-count');
      if (allAuditCountEl) {
        allAuditCountEl.textContent = allAuditCount + '問';
      }
      
      // Add click handlers for subject card buttons
      document.querySelectorAll('.subject-card-buttons button').forEach(btn => {
        btn.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          const subcategory = this.getAttribute('data-subcategory');
          const mode = this.getAttribute('data-mode');
          
          const filtered = questions.filter(q => {
            if (!q.category || q.category !== category) return false;
            return subcategory ? q.subcategory === subcategory : true;
          });
          
          if (filtered.length === 0) return;
          
          // Select questions based on mode
          let selectedQuestions;
          if (mode === 'random') {
            // Shuffle and select 10 questions
            selectedQuestions = filtered.sort(() => Math.random() - 0.5).slice(0, 10);
          } else {
            // All questions in random order
            selectedQuestions = filtered.sort(() => Math.random() - 0.5);
          }
          
          // Create quiz title
          const quizTitle = subcategory ? `${category} - ${subcategory}` : category;
          
          displayQuiz(selectedQuestions, quizTitle);
        });
      });
      
      // すべての監査問題ボタンのイベントハンドラ
      const allAuditRandomBtn = document.getElementById('all-audit-random');
      const allAuditAllBtn = document.getElementById('all-audit-all');
      
      if (allAuditRandomBtn) {
        allAuditRandomBtn.addEventListener('click', function() {
          const filtered = questions.filter(q => q.category === '監査論' || q.category === '監査実務');
          if (filtered.length === 0) return;
          const selectedQuestions = filtered.sort(() => Math.random() - 0.5).slice(0, 10);
          displayQuiz(selectedQuestions, '監査論 - すべての問題');
        });
      }
      
      if (allAuditAllBtn) {
        allAuditAllBtn.addEventListener('click', function() {
          const filtered = questions.filter(q => q.category === '監査論' || q.category === '監査実務');
          if (filtered.length === 0) return;
          const selectedQuestions = filtered.sort(() => Math.random() - 0.5);
          displayQuiz(selectedQuestions, '監査論 - すべての問題');
        });
      }
    });
    
    function displayQuiz(quizQuestions, quizTitle) {
      const quizContainer = document.getElementById('quiz');
      const homeContainer = document.getElementById('quiz-home');
      const headerSubtitle = document.getElementById('header-subtitle');
      
      homeContainer.classList.add('hidden');
      quizContainer.classList.remove('hidden');
      if (headerSubtitle) {
        headerSubtitle.textContent = quizTitle || 'クイズ';
        headerSubtitle.classList.remove('hidden');
      }
      
      let currentQuestion = 0;
      const userAnswers = []; // ユーザーの回答を記録
      
      function showQuestion() {
        const q = quizQuestions[currentQuestion];
        
        // 選択肢をシャッフル
        const shuffledChoices = q.choices.map((choice, index) => ({
          choice: choice,
          meaning: q.meanings[index],
          originalIndex: index
        }));
        
        // Fisher-Yatesアルゴリズムでシャッフル
        for (let i = shuffledChoices.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffledChoices[i], shuffledChoices[j]] = [shuffledChoices[j], shuffledChoices[i]];
        }
        
        // 新しい正解のインデックスを見つける
        const newCorrectIndex = shuffledChoices.findIndex(item => item.originalIndex === q.answer);
        
        quizContainer.innerHTML = `
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
              <div class="progress">${currentQuestion + 1} / ${quizQuestions.length}</div>
              <button onclick="returnToHome()" style="padding:6px 12px;font-size:13px;background:#6b7280;color:#fff;border:none;border-radius:6px;cursor:pointer">トップに戻る</button>
            </div>
            <div class="progress-bar" style="display:block">
              <div class="progress-fill" role="progressbar" style="width:${((currentQuestion + 1) / quizQuestions.length * 100)}%"></div>
            </div>
            <p><strong>${q.question}</strong></p>
            <p id="translation" style="color:var(--muted);font-size:14px;display:none">${q.translation}</p>
            <ul class="options">
              ${shuffledChoices.map((item, i) => `
                <li>
                  <label id="choice-${i}">
                    <input type="radio" name="answer" value="${i}">
                    <span class="choice-text">${item.choice}</span>
                  </label>
                </li>
              `).join('')}
            </ul>
            <button onclick="checkAnswer(${newCorrectIndex}, ${currentQuestion}, ${quizQuestions.length}, ${JSON.stringify(shuffledChoices).replace(/"/g, '&quot;')})">答える</button>
            <div id="result"></div>
          </div>
        `;
      }
      
      window.checkAnswer = function(correctAnswer, questionNum, total, shuffledChoices) {
        const selected = document.querySelector('input[name="answer"]:checked');
        if (!selected) return;
        
        const isCorrect = parseInt(selected.value) === correctAnswer;
        const resultDiv = document.getElementById('result');
        const q = quizQuestions[questionNum];
        
        // ユーザーの回答を記録
        userAnswers[questionNum] = {
          question: q,
          shuffledChoices: shuffledChoices,
          correctIndex: correctAnswer,
          userAnswerIndex: parseInt(selected.value),
          isCorrect: isCorrect
        };
        
        // 正解の選択肢をハイライト
        const correctLabel = document.getElementById(`choice-${correctAnswer}`);
        correctLabel.classList.add('correct');
        
        // 不正解の場合、選んだ選択肢をハイライト
        if (!isCorrect) {
          const selectedLabel = document.getElementById(`choice-${selected.value}`);
          selectedLabel.classList.add('incorrect');
        }
        
        // ボタンを無効化
        const answerButton = document.querySelector('button');
        answerButton.disabled = true;
        answerButton.style.opacity = '0.5';
        
        // 正誤判定メッセージ
        let resultHTML = '';
        if (isCorrect) {
          resultHTML = '<div style="color:var(--success);background:#ecfdf5;padding:12px;border-radius:6px;margin-top:12px">✓ 正解です！</div>';
        } else {
          resultHTML = `<div style="color:var(--error);background:#fef2f2;padding:12px;border-radius:6px;margin-top:12px">✗ 不正解。正解は: <strong>${shuffledChoices[correctAnswer].choice}</strong></div>`;
        }
        
        // 問題文の和訳を追加
        resultHTML += `<div style="margin-top:12px;padding:12px;background:#f0f9ff;border-radius:6px;font-size:14px;color:var(--text)">
          <div style="font-weight:600;margin-bottom:4px;color:var(--brand)">問題文の意味：</div>
          ${q.translation}
        </div>`;
        
        // 選択肢の日本語訳を追加（シャッフル後の順序で）
        resultHTML += '<div style="margin-top:12px;padding:12px;background:#f8fafc;border-radius:6px;font-size:14px;">';
        resultHTML += '<div style="font-weight:600;margin-bottom:8px;color:var(--brand)">各選択肢の意味：</div>';
        shuffledChoices.forEach((item, i) => {
          resultHTML += `<div style="margin:4px 0;color:var(--text)"><strong>${item.choice}</strong> - ${item.meaning}</div>`;
        });
        resultHTML += '</div>';
        
        // 解説を追加（existsの場合）
        if (q.explanation) {
          resultHTML += `<div style="margin-top:12px;padding:12px;background:#fffbeb;border-left:4px solid #fbbf24;border-radius:6px;font-size:14px;color:var(--text)">
            <div style="font-weight:600;margin-bottom:6px;color:#b45309">解説：</div>
            ${q.explanation}
          </div>`;
        }
        
        // 次の問題へボタンを追加
        if (currentQuestion < quizQuestions.length - 1) {
          resultHTML += '<button onclick="goToNextQuestion()" style="margin-top:16px">次の問題へ</button>';
        } else {
          resultHTML += '<button onclick="showResults()" style="margin-top:16px">結果を見る</button>';
        }
        
        resultDiv.innerHTML = resultHTML;
      };
      
      window.goToNextQuestion = function() {
        currentQuestion++;
        showQuestion();
      };
      
      window.showResults = function() {
        const correctCount = userAnswers.filter(a => a.isCorrect).length;
        const totalCount = userAnswers.length;
        const percentage = Math.round((correctCount / totalCount) * 100);
        
        let resultsHTML = `
          <div class="card">
            <h2>クイズ結果</h2>
            <div style="text-align:center;margin:24px 0">
              <div style="font-size:48px;font-weight:700;color:var(--brand)">${correctCount} / ${totalCount}</div>
              <div style="font-size:18px;color:var(--muted);margin-top:8px">正答率: ${percentage}%</div>
            </div>
            
            <h3 style="font-size:18px;color:var(--brand);margin-top:24px;margin-bottom:12px">問題別結果</h3>
            <div class="result-table" style="overflow-x:auto">
              <table style="width:100%;border-collapse:collapse;font-size:14px">
                <thead>
                  <tr style="background:#f8fafc;border-bottom:2px solid #e5e7eb">
                    <th style="padding:12px;text-align:left;font-weight:600">問題</th>
                    <th style="padding:12px;text-align:center;font-weight:600;width:80px">結果</th>
                    <th style="padding:12px;text-align:center;font-weight:600;width:100px">詳細</th>
                  </tr>
                </thead>
                <tbody>
        `;
        
        userAnswers.forEach((answer, index) => {
          const resultText = answer.isCorrect ? '✓ 正解' : '✗ 不正解';
          const resultColor = answer.isCorrect ? 'var(--success)' : 'var(--error)';
          resultsHTML += `
            <tr style="border-bottom:1px solid #eef2ff">
              <td style="padding:12px">第${index + 1}問</td>
              <td style="padding:12px;text-align:center;color:${resultColor};font-weight:600">${resultText}</td>
              <td style="padding:12px;text-align:center">
                <button onclick="reviewQuestion(${index})" style="padding:6px 12px;font-size:13px;background:var(--accent);color:#fff;border:none;border-radius:6px;cursor:pointer">確認</button>
              </td>
            </tr>
          `;
        });
        
        resultsHTML += `
                </tbody>
              </table>
            </div>
            <button onclick="location.reload()" style="margin-top:24px;width:100%">トップに戻る</button>
          </div>
        `;
        
        quizContainer.innerHTML = resultsHTML;
      };
      
      window.reviewQuestion = function(questionIndex) {
        const answer = userAnswers[questionIndex];
        const q = answer.question;
        const choices = answer.shuffledChoices;
        
        let reviewHTML = `
          <div class="card">
            <h3 style="color:var(--brand);margin-top:0">第${questionIndex + 1}問の確認</h3>
            
            <div style="background:#f8fafc;padding:16px;border-radius:8px;margin:16px 0">
              <div style="font-weight:600;margin-bottom:8px;color:var(--brand)">問題：</div>
              <p style="margin:0;font-size:15px"><strong>${q.question}</strong></p>
              <p style="margin:8px 0 0 0;color:var(--muted);font-size:14px">${q.translation}</p>
            </div>
            
            <div style="margin:16px 0">
              <div style="font-weight:600;margin-bottom:8px;color:var(--brand)">選択肢：</div>
        `;
        
        choices.forEach((item, i) => {
          let style = 'padding:12px;border:2px solid #e5e7eb;border-radius:8px;margin:8px 0;background:#fff';
          let label = '';
          
          if (i === answer.correctIndex) {
            style = 'padding:12px;border:2px solid #10b981;border-radius:8px;margin:8px 0;background:#ecfdf5';
            label = '<span style="color:var(--success);font-weight:600;margin-left:8px">✓ 正解</span>';
          }
          
          if (i === answer.userAnswerIndex && !answer.isCorrect) {
            style = 'padding:12px;border:2px solid #ef4444;border-radius:8px;margin:8px 0;background:#fef2f2';
            label = '<span style="color:var(--error);font-weight:600;margin-left:8px">✗ あなたの回答</span>';
          }
          
          reviewHTML += `
            <div style="${style}">
              <div style="font-size:15px"><strong>${item.choice}</strong>${label}</div>
              <div style="font-size:13px;color:var(--muted);margin-top:4px">${item.meaning}</div>
            </div>
          `;
        });
        
        reviewHTML += `
            </div>
        `;
        
        // 解説を追加（existsの場合）
        if (q.explanation) {
          reviewHTML += `
            <div style="margin-top:16px;padding:12px;background:#fffbeb;border-left:4px solid #fbbf24;border-radius:6px;font-size:14px;color:var(--text)">
              <div style="font-weight:600;margin-bottom:6px;color:#b45309">解説：</div>
              ${q.explanation}
            </div>
          `;
        }
        
        reviewHTML += `
            <div style="margin-top:24px;display:flex;gap:8px">
              <button onclick="showResults()" style="flex:1">結果一覧に戻る</button>
            </div>
          </div>
        `;
        
        quizContainer.innerHTML = reviewHTML;
      };
      
      window.returnToHome = function() {
        const homeContainer = document.getElementById('quiz-home');
        const quizContainer = document.getElementById('quiz');
        const headerSubtitle = document.getElementById('header-subtitle');
        
        quizContainer.classList.add('hidden');
        homeContainer.classList.remove('hidden');
        if (headerSubtitle) headerSubtitle.classList.remove('hidden');
      };
      
      showQuestion();
    }
  </script>
</body>
</html>