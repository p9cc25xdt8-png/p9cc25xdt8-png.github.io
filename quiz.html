<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>英語クイズ - しーぴーえいご</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f7f9fc;--card:#fff;--text:#0f1724;--muted:#4b5563;--brand:#1f3c88;--accent:#3b82f6;--focus:#0b5fff;--error:#b91c1c;--success:#047857;--shadow:0 10px 30px rgba(31,60,136,0.08)}
    body{font-family:'Inter','Noto Sans JP',system-ui,-apple-system,'Segoe UI',sans-serif;margin:0;padding:0;background:var(--bg);color:var(--text);}
    header{background:linear-gradient(180deg,var(--brand),#19407a);color:#fff;padding:28px 20px;text-align:center}
    header h1{font-family:'Noto Sans JP', 'Inter';font-weight:700;margin:0;font-size:22px}
    .card{background:var(--card);max-width:760px;margin:18px auto;padding:18px;border-radius:10px;box-shadow:var(--shadow)}

    /* Subject tabs */
    .subject-tabs{display:flex;gap:8px;max-width:760px;margin:16px auto;padding:0 18px}
    .subject-tabs button{background:transparent;border:1px solid rgba(31,60,136,0.06);padding:8px 12px;border-radius:8px;cursor:pointer;color:var(--brand);font-weight:600}
    .subject-tabs button[aria-selected="true"]{background:linear-gradient(90deg,var(--accent),var(--brand));color:#fff;border:none;box-shadow:0 6px 18px rgba(31,60,136,0.08)}
    .subject-tabs button:focus-visible{outline:3px solid var(--focus);outline-offset:3px}

    .options{display:flex;flex-direction:column;gap:12px;margin:16px 0;padding:0}
    .card label{display:flex;align-items:center;gap:12px;padding:14px 16px;border:2px solid #e5e7eb;border-radius:10px;background:#fff;cursor:pointer;transition:all 0.2s ease;font-size:15px}
    .card label:hover{background:#f8fafc;border-color:#cbd5e1}
    .card label input[type="radio"]{width:20px;height:20px;cursor:pointer;accent-color:var(--brand)}
    .card button{margin-top:12px;padding:10px 16px;background:var(--brand);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;transition:transform .12s ease,box-shadow .12s ease}
    .card button:active{transform:translateY(1px)}

    .progress-bar{height:8px;background:linear-gradient(90deg,#eef2ff,#f8fafc);border-radius:999px;overflow:hidden;margin:12px 0}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--brand));width:0%;transition:width .4s cubic-bezier(.2,.9,.3,1)}

    /* answer highlight */
    .card label.correct{background:#ecfdf5;border-color:#10b981;box-shadow:0 4px 12px rgba(16,185,129,0.15)}
    .card label.incorrect{background:#fef2f2;border-color:#ef4444;box-shadow:0 4px 12px rgba(239,68,68,0.15)}

    /* subtle fade for results */
    #result{transition:opacity .18s ease,transform .18s ease;opacity:1}

    nav.site-nav{background:#fff;border-bottom:1px solid #ddd;padding:12px 20px;position:relative}
    .menu-toggle{display:block;background:var(--brand);color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-weight:600;font-size:16px}
    nav.site-nav > div:last-child{display:none;flex-direction:column;gap:8px;margin-top:12px}
    nav.site-nav.open > div:last-child{display:flex}
    nav.site-nav a{text-decoration:none;color:var(--brand);font-weight:500;padding:10px 12px;background:#f8f9fa;border-radius:6px;display:block;text-align:center}
    nav.site-nav a:hover{background:#e9ecef}
    @media(min-width:768px){
      .menu-toggle{display:none}
      nav.site-nav > div:last-child{display:flex!important;flex-direction:row;gap:0;margin-top:0}
      nav.site-nav a{display:inline;padding:8px 12px;background:transparent;margin-right:15px}
      nav.site-nav a:last-child{margin-right:0}
      nav.site-nav a:hover{background:transparent;text-decoration:underline}
    }

    /* Results table */
    .result-table{width:100%;border-collapse:collapse;margin-top:12px}
    .result-table th,.result-table td{padding:12px;border-bottom:1px solid #eef2ff;text-align:left}
    .result-table td.ok{color:var(--success);font-weight:600}
    .result-table td.ng{color:var(--error);font-weight:600}
    .result-table button{padding:6px 10px;border-radius:6px;border:none;background:var(--accent);color:#fff;cursor:pointer}
    .result-table button:hover{filter:brightness(.95)}

    /* Skip link (visually hidden until focused) */
    .skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{position:static;left:auto;width:auto;height:auto;padding:8px 12px;margin:8px;background:#fff;border:1px solid #eef2ff;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}

    /* Focus styles for keyboard users */
    :focus{outline:none}
    :focus-visible{outline:none}
    /* Strong visible focus for keyboard users */
    button:focus-visible, .skip-link:focus-visible, .card label:focus-visible, nav.site-nav a:focus-visible, .result-table button:focus-visible {
      outline:3px solid var(--focus);
      outline-offset:3px;
      border-radius:6px;
      box-shadow:0 8px 24px rgba(11,88,255,0.10);
    }
    /* Larger ring in high-contrast mode */
    @media (prefers-contrast: more) {
      button:focus-visible, .skip-link:focus-visible, .card label:focus-visible, nav.site-nav a:focus-visible, .result-table button:focus-visible {
        outline-width:4px;
      }
    }
    .card label:focus-visible{box-shadow:0 8px 24px rgba(11,88,255,0.10)}

    /* ensure label text is high contrast */
    .card label{color:var(--text)}
    .card label.correct{background:linear-gradient(180deg,#e6ffef,#f0fff5);border-color:#bbf7d0;box-shadow:0 6px 14px rgba(4,110,60,0.06)}
    .card label.incorrect{background:linear-gradient(180deg,#fff1f0,#fff6f6);border-color:#f87171;box-shadow:0 6px 14px rgba(220,38,38,0.06)}
    .result-table td.ng{color:var(--error);font-weight:600}
    .result-table td.ok{color:var(--success);font-weight:600}
    .progress-bar{border:1px solid rgba(0,0,0,0.04);padding:2px;border-radius:10px}

    /* explanation area */
    .explanation{margin-top:8px;font-size:14px;color:var(--muted)}
  </style>
</head>
<body>
  <!-- Skip link for accessibility -->
  <a href="#quiz" class="skip-link">クイズへスキップ</a>

  <nav class="site-nav">
    <button class="menu-toggle" onclick="this.parentElement.classList.toggle('open')">☰ メニュー</button>
    <div>
      <a href="index.html">トップ</a>
      <a href="quiz.html" aria-current="page">英語クイズ</a>
      <a href="account-list.html">勘定科目リスト</a>
      <a href="about.html">サービスについて</a>
    </div>
  </nav>

  <header>
    <h1>英語クイズ</h1>
    <p>勘定科目等 — 会計英語で即フィードバック</p>
  </header>

  <section>
    <!-- Quiz top / subject selection -->
    <div id="quiz-home" class="card">
      <h2>クイズを始める</h2>
      <p>学習したいカテゴリを選んでください。各カテゴリをクリックするとランダムで10問出題されます。</p>
      
      <p style="background:#fffbeb;border-left:4px solid #f59e0b;padding:12px;margin-top:16px;font-size:14px;color:var(--text)">
        <strong>注意：</strong>本クイズは日本基準を前提として作成しています。
      </p>
      
      <div style="margin:20px 0">
        <h3 style="font-size:16px;color:var(--muted);margin-bottom:12px">勘定科目の分類別</h3>
        <div class="subject-cards" role="list">
          <button class="subject-card" data-subcategory="資産" role="listitem" tabindex="0">
            資産
            <span class="count" data-subcategory="資産">0問</span>
          </button>
          <button class="subject-card" data-subcategory="負債" role="listitem" tabindex="0">
            負債
            <span class="count" data-subcategory="負債">0問</span>
          </button>
          <button class="subject-card" data-subcategory="収益" role="listitem" tabindex="0">
            収益
            <span class="count" data-subcategory="収益">0問</span>
          </button>
          <button class="subject-card" data-subcategory="費用" role="listitem" tabindex="0">
            費用
            <span class="count" data-subcategory="費用">0問</span>
          </button>
        </div>
      </div>
      
      <div style="margin:20px 0">
        <h3 style="font-size:16px;color:var(--muted);margin-bottom:12px">全問題</h3>
        <div class="subject-cards" role="list">
          <button class="subject-card" data-subject="勘定科目等" role="listitem" tabindex="0">
            すべての問題
            <span class="count" data-subject="勘定科目等">0問</span>
          </button>
        </div>
      </div>
    </div>

    <div class="progress-bar hidden" aria-hidden="true">
      <div class="progress-fill" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" style="width:0%"></div>
    </div>

    <div id="quiz" class="hidden"></div>
  </section>

  <footer style="text-align:center;padding:20px;background:#eee">
    <p>© 2026 しーぴーえいご</p>
    <p style="margin-top:8px">
      <a href="privacy.html" style="color:var(--brand);text-decoration:none;margin-right:15px">プライバシーポリシー</a>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSd3WB8gTG7oJBGPse9XFBi6AvNBxu7nkkL3BVHSP438u3E2LQ/viewform" target="_blank" style="color:var(--brand);text-decoration:none">お問い合わせ</a>
    </p>
  </footer>

  <script src="questions.js"></script>
  <script>
    // Initialize quiz UI
    document.addEventListener('DOMContentLoaded', function() {
      const counts = {
        '資産': 0,
        '負債': 0,
        '収益': 0,
        '費用': 0,
        '勘定科目等': 0
      };
      
      if (typeof questions !== 'undefined') {
        questions.forEach(q => {
          if (q.subcategory) {
            counts[q.subcategory]++;
          }
          counts['勘定科目等']++;
        });
      }
      
      // Update counts in UI
      document.querySelectorAll('.count').forEach(el => {
        const key = el.getAttribute('data-subcategory') || el.getAttribute('data-subject');
        el.textContent = (counts[key] || 0) + '問';
      });
      
      // Add click handlers for subject cards
      document.querySelectorAll('.subject-card').forEach(btn => {
        btn.addEventListener('click', function() {
          const subcategory = this.getAttribute('data-subcategory');
          const subject = this.getAttribute('data-subject');
          const filtered = questions.filter(q => {
            return subcategory ? q.subcategory === subcategory : true;
          });
          
          if (filtered.length === 0) return;
          
          // Shuffle and select 10 questions
          const shuffled = filtered.sort(() => Math.random() - 0.5).slice(0, 10);
          displayQuiz(shuffled);
        });
      });
    });
    
    function displayQuiz(quizQuestions) {
      const quizContainer = document.getElementById('quiz');
      const homeContainer = document.getElementById('quiz-home');
      homeContainer.classList.add('hidden');
      quizContainer.classList.remove('hidden');
      
      let currentQuestion = 0;
      
      function showQuestion() {
        const q = quizQuestions[currentQuestion];
        quizContainer.innerHTML = `
          <div class="card">
            <div class="progress-bar" style="display:block">
              <div class="progress-fill" role="progressbar" style="width:${((currentQuestion + 1) / quizQuestions.length * 100)}%"></div>
            </div>
            <div class="progress">${currentQuestion + 1} / ${quizQuestions.length}</div>
            <p><strong>${q.question}</strong></p>
            <p id="translation" style="color:var(--muted);font-size:14px;display:none">${q.translation}</p>
            <ul class="options">
              ${q.choices.map((choice, i) => `
                <li>
                  <label id="choice-${i}">
                    <input type="radio" name="answer" value="${i}">
                    <span class="choice-text">${choice}</span>
                  </label>
                </li>
              `).join('')}
            </ul>
            <button onclick="checkAnswer(${q.answer}, ${currentQuestion}, ${quizQuestions.length})">答える</button>
            <div id="result"></div>
          </div>
        `;
      }
      
      window.checkAnswer = function(correctAnswer, questionNum, total) {
        const selected = document.querySelector('input[name="answer"]:checked');
        if (!selected) return;
        
        const isCorrect = parseInt(selected.value) === correctAnswer;
        const resultDiv = document.getElementById('result');
        const translationDiv = document.getElementById('translation');
        const q = quizQuestions[questionNum];
        
        // 日本語訳を表示
        translationDiv.style.display = 'block';
        
        // 正解の選択肢をハイライト
        const correctLabel = document.getElementById(`choice-${correctAnswer}`);
        correctLabel.classList.add('correct');
        
        // 不正解の場合、選んだ選択肢をハイライト
        if (!isCorrect) {
          const selectedLabel = document.getElementById(`choice-${selected.value}`);
          selectedLabel.classList.add('incorrect');
        }
        
        // ボタンを無効化
        const answerButton = document.querySelector('button');
        answerButton.disabled = true;
        answerButton.style.opacity = '0.5';
        
        // 正誤判定メッセージ
        let resultHTML = '';
        if (isCorrect) {
          resultHTML = '<div style="color:var(--success);background:#ecfdf5;padding:12px;border-radius:6px;margin-top:12px">✓ 正解です！</div>';
        } else {
          resultHTML = `<div style="color:var(--error);background:#fef2f2;padding:12px;border-radius:6px;margin-top:12px">✗ 不正解。正解は: <strong>${q.choices[correctAnswer]}</strong></div>`;
        }
        
        // 選択肢の日本語訳を追加
        resultHTML += '<div style="margin-top:16px;padding:12px;background:#f8fafc;border-radius:6px;font-size:14px;">';
        resultHTML += '<div style="font-weight:600;margin-bottom:8px;color:var(--brand)">各選択肢の意味：</div>';
        q.choices.forEach((choice, i) => {
          resultHTML += `<div style="margin:4px 0;color:var(--text)"><strong>${choice}</strong> - ${q.meanings[i]}</div>`;
        });
        resultHTML += '</div>';
        
        // 次の問題へボタンを追加
        if (currentQuestion < quizQuestions.length - 1) {
          resultHTML += '<button onclick="goToNextQuestion()" style="margin-top:16px">次の問題へ</button>';
        } else {
          resultHTML += '<button onclick="showResults()" style="margin-top:16px">結果を見る</button>';
        }
        
        resultDiv.innerHTML = resultHTML;
      };
      
      window.goToNextQuestion = function() {
        currentQuestion++;
        showQuestion();
      };
      
      window.showResults = function() {
        quizContainer.innerHTML = '<div class="card"><h2>クイズ完了！</h2><p>お疲れ様でした。</p><button onclick="location.reload()">戻る</button></div>';
      };
      
      showQuestion();
    }
  </script>
</body>
</html>